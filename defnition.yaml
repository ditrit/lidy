
description: str

namespace: str

range:
  list:
    - ele: 
        oneOf:
          - int
          - const: unbounded
      required: true
    - ele:
        oneOf:
          - int
          - const: unbounded
      required: true

metadata:
  dictOf: 
    keys: str
    val: str

imports:
  listOf:
    eles:
      oneOf:
        - str
        - dictOf:
            keys: str
            val: str
          min: 1
          max: 1
        - dict:
            - key: str
              val: 
                dict:
                  - key: file
                    val: str
                    required: true
                  - key: repository
                    val: str
                    required: false
                  - key: namespace_prefix
                    val: str
                    required: true
                  - key: namespace_uri
                    val: str
                    required: true

constraint:
  oneOf:
    - key: equal
      val: any
    - key: greater_than
      val: value
    - key: greater_or_equal
      val: value
    - key: less_than
      val: value
    - key: less_or_equal
      val: value
    - key: in_range
      val: range
    - key: valid_values
      val: list
    - key: length
      val: int
    - key: min_length
      val: int
    - key: max_length
      val: int
    - key: pattern
      val: str
    - key: schema
      val: str

constraints:
  listOf: 
    eles: constraint

entry_schema:
  oneOf:
    - str
    - dict:
        - key: type 
          val: str
          required: true
        - key: description
          val: description
          required: false
        - key: constraints 
          val: constraints
          required: false
        - key: entry_schema
          val: entry_schema
          required: false

string_value_expresion:
  oneOf: 
    - str
    - value_expression

value_expression:
  oneOf:
    - key: concat, 
      val: 
        listOf: 
          eles: string_value_expression 
        min: 1
    - key: get_input 
      val: str
    - key: get_nodes_of_type 
      val: str
    - key: token
      val: 
        list: 
          - ele: string_value_expression, 
            required: true
          - ele: str
            required: true
          - ele: int
            required: true   
    - key: join
      val: 
        list: 
          - ele: 
              listOf: 
                eles: string_value_expression
              min: 1 
            required: true
          - ele: str, 
            required: false
    - key: get_property
      val: 
        list: 
          - ele: str
            required: true
          - ele: str
            required: false
          - ele: str
            required: true
          - eles: 
              oneOf:
                - int
                - str
            required: false
    - key: get_attribute
      val: 
        list: 
          - ele: str
            required: true
          - ele: str
            required: false
          - ele: str
            required: true
          - eles: 
              oneOf:
                - int
                - str
            required: false
    - key: get_operation_output
      val: 
        list: 
          - ele: str
            required: true
          - ele: str
            required: true
          - ele: str
            required: true
          - ele: str
            required: true
    - key: get_artifact
      val: 
        list: 
          - ele: str
            required: true
          - ele: str
            required: true
          - ele: str
            required: false
          - ele: bool
            required: true

property:
  dict:
    - key: type, 
      val: str 
      required: true
    - key: description
      val: description
      required: false
    - key: constraints
      val: constraints
      required: false
    - key: required
      val: bool
      required: false
    - key: default
      val: value
      required: false
    - key: status
      val: 
        enum: [ supported, unsupported, experimental, deprecated, optional ]
        required: false
    - key: metadata
      val: metadata, 
      required: false
    - key: entry_schema
      val: entry_schema
      required: false 

properties:
  dictOf: 
    keys: str, 
    val: property

property_assignment:
  oneOf:
    - value_expression
    - value
    - dict:
      - key: description:
        val: description
        required: false
      - key: value
        val:
          oneOf:
            - value_expression
            - value

property_assignments:
  dictOf: 
    keys: str, 
    val: property_assignment

attribute:
  dict:
    - key: type, 
      val: str 
      required: true
    - key: description
      val: description
      required: false
    - key: default
      val: value
      required: false
    - key: status
      val: 
        enum: [ supported, unsupported, experimental, deprecated, optional ]
        required: false
    - key: entry_schema
      val: entry_schema
      required: false 

attributes:
  dictOf: 
    keys: str, 
    val: attribute

attribute_assignment:
  oneOf:
    - value_expression
    - value
    - dict:
      - key: description:
        val: description
        required: false
      - key: value
        val:
          oneOf:
            - value_expression
            - value

attribute_assignments:
  dictOf: 
    keys: str, 
    val: attribute_assignment

input_parameter:
  dict:
    - key: type, 
      val: str 
      required: true
    - key: description
      val: description
      required: false
    - key: constraints
      val: constraints
      required: false
    - key: required
      val: bool
      required: false
    - key: default
      val: value
      required: false
    - key: status
      val: 
        enum: [ supported, unsupported, experimental, deprecated, optional ]
        required: false
    - key: entry_schema
      val: entry_schema
      required: false 
    - key: value
      val: 
        oneOf: 
          - value
          - value_expression
      required: false 

input_parameters:
  dictOf: 
    keys: str, 
    val: input_parameter

input_assignments:
  property_assignments

output_parameter:
  dict:
    - key: type, 
      val: str 
      required: true
    - key: description
      val: description
      required: false
    - key: constraints
      val: constraints
      required: false
    - key: required
      val: bool
      required: false
    - key: default
      val: value
      required: false
    - key: status
      val: 
        enum: [ supported, unsupported, experimental, deprecated, optional ]
        required: false
    - key: entry_schema
      val: entry_schema
      required: false 
    - key: value
      val: 
        oneOf: 
          - value
          - value_expression
      required: false 

output_parameters:
  dictOf: 
    keys: str, 
    val: output_parameter

repository:
  anyOf:
    - str
    - dict:
      - key: url
        val: str
        required: true
      - key: description
        val: description
        required: false
      - key: credential
        required: false
        val: 
          dict:
            - key: protocol
              val: str
              required: false
            - key: token
              val: str
              required: false
            - key: token_type
              val: str
              required: false
            - key: user
              val: str
              required: false

artifact_def: 
  oneOf:
    - str
    - dict:
        - key: type
          val: str
          required: true
        - key: file
          val: str
          required: true
        - key: repository
          val: str
          required: false
        - key: description
          val: description
          required: false
        - key: deploy_path
          val: str
          required: false

artifact_defs:
  dictOf:
    keys: str
    val: artifact_def

type_common_keys:
  dict:
    - key: derived_from
      val: str
      required: false
    - key: version
      val: version
      required: false
    - key: metadata
      val: metadata
      required: false
    - key: description
      val: description
      required: false


artifact_type:
  dict:
    - key: file_ext
      val: str
      required: false
    - key: mime_type
      val: str
      required: false
    - key: properties
      val: properties
      required: false
  copy: type_common_keys

artifact_types:
  dictOf:
    keys: str
    val: artifact_type

data_type:
  dict:
    - key: properties
      val: properties
      required: false
    - key: constraints
      val: constraints
      required: false
  copy: type_common_keys

implementation:
  oneOf:
    - str
    - dict:
        - key: primary
          val: 
            oneOf:
              - str
              - artifact_def
          required: true
        - key: dependencies
          val:
            listOf:
              eles: 
                oneOf:
                  - str
                  - artifact_def
            required: false

operation_def:
  dict:
    - key: description
      val: description
      required: false
    - key: inputs
      val: properties
      required: false
    - key: implementation
      val: implementation
      required: false

operation_def_template:
  dict:
    - key: description
      val: description
      required: false
    - key: inputs
      val: input_assignments
      required: false
    - key: implementation
      val: implementation
      required: false

interface_type:
  dict:
    - key: inputs
      val: properties
      required: false
    - keys: str
      val: operation_def
      required: false
  copy: type_common_keys

interface_types:
  dictOf:
    keys: str
    val: interface_def

interface_def:
  dict:
    - key: type
      val: str
      required: true
    - key: inputs
      val: properties
      required: false
  copy: operation_def

interface_defs:
  dictOf:
    keys: str
    val: interface_def

interface_def_template:
  dict:
    - key: inputs
      val: properties
      required: false
  copy: operation_def

interface_defs_template:
  dictOf:
    keys: str
    val: interface_def_template

capability_type:
  dict:
    - key: properties
      val: properties
      required: false
    - key: attributes
      val: attributes
      required: false
    - key: valid_source_types
      val: 
        listOf:
          eles: str
  copy: type_common_keys

capability_def:
  oneOf:
    - dict:
        - key: type
          val: str
          required: false
        - key: description
          val: description
          required: false
        - key: properties
          val: properties
          required: false
        - key: attributes
          val: attributes
        - key: valid_source_types
          val: 
            listOf:
              eles: str
        - key: occurrences
          val: range
          required: false
    - str

capability_defs:
  dictOf:
    keys: str
    val: capability_def

capability_assignment:
  dict:
    - key: properties
      val: property_assignments
      required: false
    - key: attributes
      val: attribute_assignments
      required: true

capability_assignments:
  dictOf:
    keys: str
    val: capability_assignment

properties_filter:
  listOf:
    eles:
      dictOf:
        keys: str
        val: 
          oneOf:
            - constraint
            - value
            - listOf:
                eles:
                  oneOf:
                    - constraint
                    - value 
      nb: 1 

capabilities_filter:
  listOf:
    eles:
      dictOf:
        keys: str
        val: 
          dict:
            - key: properties
              val: properties_filter
      nb: 1 

node_filter:
  dict:
    - key: properties
      val: properties_filter
      required: false
    - key: capabilities
      val: capabilities_filter
      required: false

requirement_defs:
  listOf:
    eles:
      nb: 1
      dictOf:
        keys: str
        val: 
          oneOf:
            - str
            - dict:
                - key: capability
                  val: str
                  required: true
                - key: description
                  val: description
                  required: false
                - key: node
                  val: str
                  required: false
                - key: occurences
                  val: range
                  required: false
                - key: relationship
                  val: 
                    oneOf:
                      - str
                      - dict:
                          - key: type
                            val: str
                            required: false
                          - key: interfaces
                            val: interface_defs
                            required: false

requirement_assignments:
  listOf:
    eles:
      nb: 1
      dictOf:
        keys: str
        val: 
          oneOf:
            - str
            - dict:
                - key: node
                  val: str
                  required: false
                - key: relationship
                  val: 
                    oneOf:
                      - str
                      - dict:
                          - key: type
                            val: str
                            required: false
                          - key: properties
                            val: property_assignments
                            required: false
                          - key: interfaces
                            val: interface_defs_template
                            required: false
                - key: capability
                  val: str
                  required: false
                - key: occurrences
                  val: range
                  required: false
                - key: node_filter
                  val: node_filter
                  required: false

workflow_condition_clause:
  listOf:
    eles:
      nb: 1
      dict:
        - key: or
          val: workflow_condition_clause
          required: false
        - key: and
          val: workflow_condition_clause
          required: false
        - key: assert
          val: 
            listOf:
              eles:
                nb: 1
                dictOf:
                  keys: str
                  val: constraints
        - keys: str
          val: 
            nb: 1
            dictOf:
              keys: str
              val: constraints
          required: false

workflow_preconditions:
  listOf:
    eles:
      dict:
        - key: target
          val: str
          required: false
        - key: target_relationship
          val: str
          required: false
        - key: condition
          val: workflow_condition_clause
          required: false

workflow_activities:
  listOf:
    eles:
      dict:
        - key: delegate
          val: str
          required: false
        - key: set_state
          val: str
          required: false
        - key: call_operation
          val: str
          required: false
        - key: inline
          val: str
          required: false

workflow_steps:
  listOf:
    eles:
      nb: 1
      dictOf:
        keys: str
        val: 
          dict:
            - key: target
              val: str
              required: false
            - key: target_relationship
              val: str
              required: false
            - key: filter
              val: workflow_condition_clause
              required: false
            - key: activities
              val: workflow_activities
              required: false
            - key: operation_host
              val: str
              required: false
            - key: on_succes
              val: 
                oneOf:
                  - str
                  - list:
                      ele: str
            - key: on_failure
              val: 
                oneOf:
                  - str
                  - list:
                      ele: str

workflow_source_weaving:
  listOf:
    - eles:
        dict:
          - key: after
            val: str
            required: false
          - key: before
            val: str
            required: false
          - key: wait_target
            val: str
            required: false
          - key: after_target
            val: str
            required: false
          - key: activity
            val: str
            required: false

workflow_target_weaving:
  listOf:
    - eles:
        dict:
          - key: after
            val: str
            required: false
          - key: before
            val: str
            required: false
          - key: wait_source
            val: str
            required: false
          - key: after_source
            val: str
            required: false
          - key: activity
            val: str
            required: false

declarative_workflow_node_defs:
  listOf:
    eles:
      nb: 1
      dictOf:
        keys: str
        val: 
          dict:
            - key: description
              val: description
              required: false
            - key: metadata
              val: metadata
              required: false
            - key: inputs
              val: properties
              required: false
            - key: preconditions
              val: workflow_preconditions
              required: false
            - key: steps
              val: workflow_steps
              required: false
          
declarative_workflow_rel_defs:
  listOf:
    eles:
      nb: 1
      dictOf:
        keys: str
        val: 
          dict:
            - key: description
              val: description
              required: false
            - key: metadata
              val: metadata
              required: false
            - key: inputs
              val: properties
              required: false
            - key: preconditions
              val: workflow_preconditions
              required: false
            - key: source_weaving
              val: workflow_source_weaving
              required: false
            - key: target_weaving
              val: workflow_target_weaving
              required: false

imperative_workflow_defs:
  listOf:
    eles:
      nb: 1
      dictOf:
        keys: str
        val: 
          dict:
            - key: description
              val: description
              required: false
            - key: metadata
              val: metadata
              required: false
            - key: inputs
              val: properties
              required: false
            - key: preconditions
              val: workflow_preconditions
              required: false
            - key: steps
              val: workflow_steps
              required: false

node_type:
  dict:
    - key: properties
      val: properties
      required: false
    - key: attributes
      val: attributes
      required: false
    - key: capabilities
      val: capability_defs
      required: false
    - key: requirements
      val: requirement_defs
      required: false
    - key: interfaces
      val: interface_defs
      required: false
    - key: workflows
      val: declarative_workflow_node_defs
      required: false
  copy: type_common_keys

node_types:
  dictOf:
    keys: str
    val: node_type

node_template:
  dict:
    - key: type
      val: str
      required: true
    - key: metadata
      val: metadata
      required: false
    - key: description
      val: description
      required: false
    - key: directives
      val: 
        list:
          eles: str
    - key: properties
      val: property_assignments
      required: false
    - key: attributes
      val: attribute_assignments
      required: false
    - key: capabilities
      val: capability_assignments
      required: false
    - key: requirements
      val: requirement_assignments
      required: false
    - key: interfaces
      val: interface_defs_template
      required: false
    - key: artifacts
      val: artifact_defs
      required: false
    - key: node_filter
      val: node_filter
      required: false
    - key: copy
      val: str
      required: false

node_templates:
  dictOf:
    keys: str
    val: node_template

relationship_type:
  dict:
    - key: properties
      val: properties
      required: false
    - key: attributes
      val: attributes
      required: false
    - key: interfaces
      val: interface_defs
      required: false
    - key: valid_target_types
      val:
        listOf:
          eles: str
    - key: workflows
      val: declarative_workflow_rel_defs
      required: false
copy: type_common_keys

relationship_types:
  dictOf:
    keys: str
    val: relationship_type

relationship_template:
  dict:
    - key: type
      val: str
      required: true
    - key: description
      val: required
      required: false
    - key: metadata
      val: metadata
      required: false
    - key: properties
      val: properties
      required: true
    - key: attributes
      val: attributes
      required: true
    - key: interfaces
      val: inteface_defs_template
      required: false
    - key: copy
      val: str
      required: false

relationship_templates:
  dictOf:
    keys: str
    val: relationship_template

group_type:
  dict:
    - key: properties
      val: properties
      required: false
    - key: capabilities
      val: capability_defs
      required: false
    - key: requirements
      val: requirement_defs
      required: false
    - key: interfaces
      val: interface_defs
      required: false
    - key: members
      val:
        listOf:
          eles: str
  copy: type_common_keys

group_types:
  dictOf:
    keys: str
    val: group_type

group_def:
  dict:
    - key: type
      val: str
      required: true
    - key: metadata
      val: metadata
      required: true
    - key: description
      val: description
      required: false
    - key: properties
      val: properties
      required: false
    - key: members
      val: 
        listOf:
            eles: str
    - key: interfaces
      val: interface_defs_template
      requirede: false

group_defs:
  dictOf:
    keys: str
    val: group_def

trigger_defs:
  listOf:
    eles:
      nb: 1
      dictOf:
        keys: str
        val: 
          dict:
            - key: description
              val: description
              required: false
            - key: event
              val: 
                oneOf:
                  - str
                  - dict:
                      - key: type
                      - val: str
            - key: schedule
              val: value
              required: false
            - key: target_filter
              val: 
                dict:
                  - key: node
                    val: str
                    reauired: false
                  - key: requirement
                    val: str
                    required: false
                  - key: capability
                    val: str
                    required: false
            - key: condition
              val: 
                oneOf:
                  - constraint
                  - dict:
                      - key: constraint
                        val: constraint
                        required: false
            - key: period
              val: str
              required: false
            - key: evaluations
              val: int
              required: false
            - key: method
              val: str
              required: false
            - key: action
              val: 
                oneOf:
                  - str
                  - operation_def

policy_type:
  dict:
    - key: properties
      val: properties
      required: false
    - key: targets
      val: 
        listOf:
          eles: str
    - key: triggers
      val: trigger_defs
  copy: type_common_keys

policy_types:
  dictOf:
    keys: str
    val: policy_type

policy_defs:
  listOf:
    eles:
      nb: 1
      dictOf:
        keys: str
        val: 
          dict:
            - key: type
              val: str
              required: false
            - key: description
              val: description
              required: false
            - key: properties
              val: property_assignments
              required: false
            - key: targets
              val: 
                listOf:
                  eles: str
              required: false
            - key: triggers
              val: trigger_defs
              required: falss

properties_mapping:
  dictOf:
    keys: str
    val: 
      oneOf:
        - value
        - value_expression
        - listOf:
            max: 3
            eles: str
        - nb: 1
          dict:
            - key: mapping
              val: 
                oneOf:
                  - str
                  - max: 3
                    listOf:
                      eles: str
            - key: value
              val: oneOf
                - value
                - value_expression

attributes_mapping:
  dictOf:
    keys: str
    val: 
      oneOf:
        - value
        - value_expression
        - listOf:
            max: 3
            eles: str
        - nb: 1
          dict:
            - key: mapping
              val: 
                oneOf:
                  - str
                  - max: 3
                    listOf:
                      eles: str
            - key: value
              val: oneOf
                - value
                - value_expression

capabilities_mapping:
  dictOf:
    keys: str
    val: 
      oneOf:
        - listOf:
            max: 2
            eles: str
        - dict:
            - key: mapping
              val: 
                oneOf:
                  - str
                  - max: 3
                    listOf:
                      eles: str
            - key: properties
              val: property_assignments
            - key: attributes
              val: attribute_assignments

requirements_mapping:
  dictOf:
    keys: str
    val: 
      oneOf:
        - listOf:
            max: 2
            eles: str
        - dict:
            - key: mapping
              val: 
                oneOf:
                  - str
                  - max: 3
                    listOf:
                      eles: str
            - key: properties
              val: property_assignments
            - key: attributes
              val: attribute_assignments

interfaces_mapping:
  dictOf:
    keys: str
    val: 
      dict:
        - key: idDefinition
          val: str

substitution_mappings:
  dict:
    - key: node_type
      val: str
      required: true
    - key: properties
      val: properties_mapping
      required: false
    - key: capabilities
      val: capabilities_mapping
      required: false
    - key: requirements
      val: requirements_mapping
      required: false
    - key: attributes
      val: attributes_mapping
      required: false
    - key: interfaces
      val: interfaces_mapping
      required: false

topology_template:
  dict:
    - key: description
      val: description
    - key: inputs
      val: input_parameters
    - key: outputs
      val: output_parameters
    - key: node_templates
      val: node_templates
    - key: relationship_templates
      val: relationship_templates
    - key: groups
      val: group_defs
    - key: policies
      val: policy_defs
    - key: substitution_mappings
      val: substitution_mappings
    - key: workflows
      val: imperative_workflow_defs

service_template:
  dict:
    - key: tosca_definitions_version
      val: str
      required: true
    - key: description
      val: description
    - key: namespace
      val: namespace
    - key: metadata
      val: metadata
    - key: repositories
      val: repositories
    - key: imports
      val: imports
    - key: artifact_types
      val: artifact_types
    - key: data_types
      val: data_types
    - key: capability_types
      val: capability_types
    - key: interface_types
      val: interface_types
    - key: relationship_types
      val: relationship_types
    - key: node_types
      val: node_types
    - key: group_types
      val: group_types
    - key: policy_types
      val: policy_types
    - key: topology_template
      val: topology_template
